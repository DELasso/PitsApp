<div class="chat-widget" [class.open]="isOpen">
  <!-- BotÃ³n flotante para abrir el chat -->
  <button 
    class="chat-toggle-btn" 
    (click)="toggleChat()"
    [attr.aria-label]="isOpen ? 'Cerrar chat' : 'Abrir chat de ayuda'"
  >
    <span *ngIf="!isOpen" class="icon">ðŸ’¬</span>
    <span *ngIf="isOpen" class="icon">âœ•</span>
  </button>

  <!-- Ventana del chat -->
  <div class="chat-window" *ngIf="isOpen">
    <!-- Header -->
    <div class="chat-header">
      <div class="header-content">
        <span class="bot-icon">ðŸ¤–</span>
        <div>
          <h3>Asistente PitsApp</h3>
          <p class="status">En lÃ­nea</p>
        </div>
      </div>
      <button class="close-btn" (click)="toggleChat()" aria-label="Cerrar chat">
        âœ•
      </button>
    </div>

    <!-- Mensajes -->
    <div class="chat-messages" #messagesContainer>
      <div 
        *ngFor="let message of messages" 
        class="message-wrapper"
        [class.user-message]="message.role === 'user'"
        [class.bot-message]="message.role === 'assistant'"
      >
        <div class="message">
          <div class="message-avatar" *ngIf="message.role === 'assistant'">
            ðŸ¤–
          </div>
          <div class="message-content">
            <p>{{ message.content }}</p>
            <span class="message-time">
              {{ message.timestamp | date: 'shortTime' }}
            </span>
          </div>
          <div class="message-avatar" *ngIf="message.role === 'user'">
            ðŸ‘¤
          </div>
        </div>
      </div>

      <!-- Indicador de escritura -->
      <div class="message-wrapper bot-message" *ngIf="isLoading">
        <div class="message">
          <div class="message-avatar">ðŸ¤–</div>
          <div class="message-content typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Input -->
    <div class="chat-input">
      <textarea
        [(ngModel)]="userMessage"
        (keypress)="onKeyPress($event)"
        placeholder="Escribe tu mensaje..."
        rows="1"
        [disabled]="isLoading"
      ></textarea>
      <button 
        (click)="sendMessage()" 
        [disabled]="!userMessage.trim() || isLoading"
        aria-label="Enviar mensaje"
      >
        <span class="send-icon">ðŸ“¤</span>
      </button>
    </div>
  </div>
</div>
